<app-modal 
  [isOpen]="isOpen" 
  [title]="'Gestionar Permisos - ' + rol?.nombre"
  size="large"
  (close)="cerrar()">
  
  <div class="modal-permisos-content">
    <!-- Buscador -->
    <div class="search-section mb-4">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Buscar permisos..."
          [(ngModel)]="buscador"
          (input)="filtrarPermisos()">
      </div>
      <div class="search-info">
        <span class="badge badge-primary">
          {{ contarPermisosSeleccionados() }} permisos seleccionados
        </span>
      </div>
    </div>

    <!-- Lista de permisos agrupados -->
    <div class="permisos-container">
      <div 
        class="permiso-grupo" 
        *ngFor="let grupo of permisosAgrupadosFiltrados">
        
        <!-- Header del módulo -->
        <div class="grupo-header">
          <div class="form-check">
            <input 
              type="checkbox" 
              class="form-check-input" 
              [id]="'modulo-' + grupo.modulo"
              [checked]="estaModuloSeleccionado(grupo)"
              [indeterminate]="estaModuloParcialmenteSeleccionado(grupo)"
              (change)="toggleModulo(grupo)">
            <label 
              class="form-check-label grupo-titulo" 
              [for]="'modulo-' + grupo.modulo">
              <i class="fas fa-folder"></i>
              {{ grupo.modulo }}
              <span class="badge badge-secondary ms-2">
                {{ grupo.permisos.length }}
              </span>
            </label>
          </div>
        </div>
        
        <!-- Permisos del módulo -->
        <div class="grupo-permisos">
          <div 
            class="form-check permiso-item" 
            *ngFor="let permiso of grupo.permisos">
            <input 
              type="checkbox" 
              class="form-check-input" 
              [id]="'permiso-' + permiso.id"
              [(ngModel)]="permiso.seleccionado">
            <label 
              class="form-check-label" 
              [for]="'permiso-' + permiso.id">
              <div class="permiso-info">
                <span class="permiso-nombre">{{ permiso.nombre }}</span>
                <span class="permiso-descripcion">{{ permiso.descripcion }}</span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Estado vacío -->
      <div class="empty-state text-center p-4" *ngIf="permisosAgrupadosFiltrados.length === 0">
        <i class="fas fa-search fa-3x text-muted mb-3"></i>
        <p class="text-muted">No se encontraron permisos que coincidan con "{{ buscador }}"</p>
      </div>
    </div>
  </div>

  <!-- Footer del modal -->
  <div slot="footer" class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="cerrar()">
      Cancelar
    </button>
    <button type="button" class="btn btn-primary" (click)="guardar()">
      <i class="fas fa-save"></i> Guardar Permisos
    </button>
  </div>
</app-modal>